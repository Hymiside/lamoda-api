# Тестовое задание Lamoda tech
## Описание
В данном решении реализованы все методы, указанные в задании. Также дополнительно реализована логика работы с множеством складов. Идея такова, товар бронируется на ближайшем складе от места заказа. Рассчеты расстояний реализованы на уровне запросов в БД, с помощью PostGIS. Все товары, что необоходимо было зарезервировать, могут быть зарезервированы на разных складах, под единым айди резервации.

API и Postgres поднимаются в отдельных docker контейнерах. После того, как запустится БД, накатываются миграции.
На все вопросы по решению я с радостью отвечу в [телеграм](https://t.me/hymiside).

Есть тесты. Тесты номинальные, только на handler, так как не хватило. В таком виде они не несут никакой пользы, но их можно посмотреть и запустить командой `go test ./...`. 

## Инструкция по разворачиванию
1. Склонируйте репозиторий
```bash
git clone https://github.com/Hymiside/lamoda-api.git
```
2. Выполните команду сброки (если необходимо, используйте `sudo`)
```
docker compose build
```
3. Выполните команду запуска
```
docker compose up
```

## Методы и ответы API
### GET | Products
Возвращает все продукты, что есть в БД
```
GET: /products
```
Пример ответа от сервера:
```json
{
  [
    {
      "id": 1,
      "part_number": "P13579",
      "title": "Product 1",
      "width": 100,
      "height": 100,
      "depth": 100
    },
    ...
  ]
}
```
Статус коды для ответов:
- 200: если все прошло успешно
- 500: если произошла ошибка на сервере

### GET | Avilability product
Возвращает наличие продуктов на складе, по идентификатору склада
```
GET: /products/availability?warehouse_id={integer}
```
Пример ответа от сервера:
```json
{
  [
    {
      "Product": {
        "id": 1,
        "part_number": "P97531",
        "title": "Product 5"
      },
      "WarehouseAvail": true,
      "Quantity": 2
    },
    ...
  ]
}
```
Статус коды для ответов:
- 200: если все прошло успешно
- 500: если произошла ошибка на сервере


### POST | Reservation products
Резервирует продукты на складе и возвращает айди резервации
```
POST: /reservation-products
```
Пример тестового запроса
```json
{
  "part_numbers": ["P13579", "P97431", "P13279"], // required
  "latitude": 21.213, // required
  "longitude": 32.23 // required
}
```
Пример ответа от сервера:
```json
{
  "reservation_id": "00000000-0000-0000-0000-000000000000"
}
```
Статус коды для ответов:
- 200: если резервация отменена
- 400: если ошибка валидации
- 500: если произошла ошибка на сервере

### DELETE | Reservation products
Отменяет резервацию продукта или продуктов на складе. Резервацию можно отменить полностью по идентификатору резервации, либо частично по массиву идентификаторов продуктов.
```
DELETE: /reservation-products
```
Пример тестового запроса
```json
{
  "reservation_id": "00000000-0000-0000-0000-000000000000", // required
  "part_numbers": ["P13579"]
}
```
Статус коды для ответов:
- 200: если резервация отменена
- 400: если ошибка валидации
- 500: если произошла ошибка на сервере


### POST | Confirm reservation
Подтверждает резервацию продукта или продуктов на складе. Резервацию можно подтвердить полностью по идентификатору резервации, либо частично по массиву идентификаторов продуктов.
```
POST: /confirm-reservation
```
Пример тестового запроса
```json
{
  "reservation_id": "00000000-0000-0000-0000-000000000000", // required
  "part_numbers": ["P13579"]
}
```
Статус коды для ответов:
- 200: если резервация подтверждена
- 400: если ошибка валидации
- 500: если произошла ошибка на сервере
